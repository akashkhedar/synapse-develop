{% extends 'users/new-ui/user_base.html' %}
{% load static %}

{% block content %}
{{ block.super }}
<script nonce="{{request.csp_nonce}}">
  gaClientIdTrackingIframe('users.signup.view');
  setTimeout(() => {
    const synapse_gaclient_id = sessionStorage.getItem('synapse_gaclient_id');
    __synapsea('users.signup.view', { synapse_gaclient_id });
  }, 2000);
</script>
{% endblock %}

{% block user_content %}
<div class="auth-form-container">
  <h2>Create Account</h2>
  <p class="subtitle">Join Synapse to start annotating and managing your data projects.</p>
  
  <form class="auth-form" action="{% url 'user-signup' %}?next={{ next }}{% if token %}&token={{ token }}{% endif %}" method="post">
    {% csrf_token %}
    <div class="form-field">
      <label for="email">Email address *</label>
      <input type="text" name="email" id="email" value="{{ user_form.data.email }}" placeholder="you@example.com" required>
      {% if user_form.errors.email %}
        <ul class="field-errors">
          {% for error in user_form.errors.email %}<li>{{ error }}</li>{% endfor %}
        </ul>
      {% endif %}
    </div>
    <div class="form-field">
      <label for="password">Password *</label>
      <input type="password" name="password" id="password" placeholder="Create a strong password" required>
      {% if user_form.errors.password %}
        <ul class="field-errors">
          {% for error in user_form.errors.password %}<li>{{ error }}</li>{% endfor %}
        </ul>
      {% endif %}
    </div>
    <div class="form-field">
      <label for="user_role">I want to use Synapse as *</label>
      <select name="user_role" id="user_role" required>
        <option value="" disabled selected>Select one</option>
        <option value="client">Client (create projects)</option>
        <option value="annotator">Annotator (label data)</option>
      </select>
    </div>
    <div class="form-field">
      <label for="how_find_us">How did you hear about Synapse?</label>
      <select name="how_find_us" id="how_find_us">
        <option disabled value="" {% if not form.data.how_find_us %}selected{% endif %}>Select an option</option>
        {% for choice in found_us_options %}
          <option value="{{ choice.1 }}" {% if choice.1 == user_form.data.how_find_us %}selected{% endif %}>{{ choice.1 }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="form-field" id="elaborateContainer" {% if user_form.data.how_find_us != elaborate %}style="display:none;"{% endif %}>
      <label for="elaborate">Please elaborate</label>
      <input name="elaborate" id="elaborate" {% if user_form.data.how_find_us == elaborate %}value="{{ user_form.data.elaborate }}"{% endif %} placeholder="Tell us more">
    </div>
    {% if form.non_field_errors %}
      {% for error in form.non_field_errors %}
        <p class="error-message">{{ error }}</p>
      {% endfor %}
    {% endif %}
    <button type="submit" class="auth-submit-btn">Create Account</button>
  </form>
  
  <p class="auth-bottom-link">Already have an account? <a href="{% url 'user-login' %}{% querystring %}">Log in</a></p>
  
</div>

<script nonce="{{request.csp_nonce}}">
  document.querySelector("#how_find_us").addEventListener('change', function(e) {
    const isOther = e.target.value == '{{ elaborate }}';
    document.querySelector("#elaborateContainer").style.display = isOther ? 'block' : 'none';
  });
</script>
{% endblock %}
